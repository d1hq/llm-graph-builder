version: '3.8'

services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    volumes:
      - ./backend:/code
    environment:
      - NEO4J_URI=neo4j://host.docker.internal:7687
      - NEO4J_PASSWORD=neo4j
      - NEO4J_USERNAME=12345678
      - EMBEDDING_MODEL=all-MiniLM-L6-v2
      - KNN_MIN_SCORE=0.94
      - IS_EMBEDDING=true
      - UPDATE_GRAPH_CHUNKS_PROCESSED=20
      - NUMBER_OF_CHUNKS_TO_COMBINE=6
      - ENTITY_EMBEDDING=True
      - LLM_MODEL_CONFIG_ollama_llama3=llama3.1,http://host.docker.internal:11434
    container_name: backend
    extra_hosts:
      - host.docker.internal:host-gateway
    ports:
      - "8000:8000"
    networks:
      - net

  frontend:
    depends_on:
      - backend
    build:
      context: ./frontend
      dockerfile: Dockerfile
      args:
        - VITE_BACKEND_API_URL=https://io-dev.document.one/api
        - VITE_REACT_APP_SOURCES=local
        - VITE_LLM_MODELS=ollama_llama3
        - VITE_BLOOM_URL=${BLOOM_URL-https://workspace-preview.neo4j.io/workspace/explore?connectURL={CONNECT_URL}&search=Show+me+a+graph&featureGenAISuggestions=true&featureGenAISuggestionsInternal=true}
        - VITE_TIME_PER_CHUNK=4
        - VITE_TIME_PER_PAGE=50
        - VITE_CHUNK_SIZE=5242880
        - VITE_ENV=DEV
        - VITE_CHAT_MODES=vector,graph,graph+vector
        - VITE_BATCH_SIZE=2
    volumes:
      - ./frontend:/app
      - /app/node_modules
      - /etc/letsencrypt:/etc/letsencrypt  
    container_name: frontend
    ports:
      - "80:80"
      - "443:443"  
    networks:
      - net

networks:
  net:
